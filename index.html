<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>
	<style type="text/css">
		ul,li{
			list-style: none;
			padding: 0;
			margin: 0;
		}
		#box{
			height: 800px;
			width: 600px;
			background-color:#014fa1;
			padding-top: 20px;
			border-radius: 8px;
		}
		#talkBar{
			height: 750px;
			width: 550px;
			margin: 0 auto;
			background-color: #fff;
			border-radius: 8px;
			overflow: scroll;
			position: relative;
		}
		#inputBar{
			text-align: center;
			margin-top: 10px;
		}
		#inputBar input{
			width: 80%;
			height: 25px;
			border-radius: 4px;
		}
		#inputBar button{
			height: 30px;
			border-radius: 4px;
			background-color: #ddd;
			color: #333;
		}
		#talkBar h4{
			font-size: 16px;
			font-weight: normal;
		}
		#talkBar li{
			margin-top: 20px;
			position: relative;
			padding-top: 5px;
		}
		#talkBar li a{
			text-decoration: none;
			color: #fff;
		}
		#talkBar li a:hover{
			color: #ddd;
		}
		#talkBar li p{
			margin: 0;
			padding: 0;
		}
		#popBox{
			display: none;
			position: absolute;
			left: 0;
			top: 0;
			width: 100%;
			height: 100%;
			background-color: rgba(0,0,0,0.7);
			overflow: scroll;
		}
		#popBox a,#popBox p,#popBox h2{
			color: #fff;
			text-align: center;
		}
		#popBox li{
			margin: 40px 10% 0;
			border-bottom: 2px solid #fff;
			padding: 0 0 10px;
		}
		#popBox h2{
			max-width: 800px;
			margin: 0 auto;
			color: #ddd;
			font-size: 20px;
		}
		#popBox p{
			max-width:  800px;
			word-break: break-all;
			margin: 0 auto;
			margin-top: 5px;
		}
		#popBox p img{
			width: 300px;
			height: auto;
		}
		#popBox p a{
			text-decoration: none;
		}
		#popBox p a:hover{
			color: orange;
		}
		#popBox .gotop{
			display: none;
			text-decoration: none;
			color: #fff;
			width: 80px;
			height: 40px;
			line-height: 40px;
			text-align: center;
			border-radius: 10px;
			position: fixed;
			bottom: 5%;
			right: 5%;
			border: 1px solid #fff;
		}
		#talkBar .usertalk{
			padding: 10px; 
			background-color: rgb(221, 221, 221); 
			min-width: 50px; 
			display: inline-block; 
			text-align: center;
		}
		#talkBar .robotstalk{
			padding: 10px; 
			background-color: rgb(93, 143, 214); 
			min-width: 50px; 
			display: inline-block; 
			text-align: center;
		}
		#talkBar .rightarrow{
			display: inline-block;
			height: 0px;
			width: 0px;
			border-top: 10px solid #ddd;
			border-right: 10px solid transparent;
			border-bottom: 10px solid transparent;
			border-left: 10px solid #ddd;
		    margin-left: -5px;
   			margin-right: 20px;
		}
		#talkBar .leftarrow{
			display: inline-block;
			height: 0px;
			width: 0px;
			border-top: 10px solid rgb(93, 143, 214);
			border-right: 10px solid rgb(93, 143, 214);
			border-bottom: 10px solid transparent;
			border-left: 10px solid transparent;
		    margin-left: 37px;
		}
		.user{
			position: absolute;
			right: 0;
			top: 0;
			font-size: 16px;
			margin: 5px 5px 0 0;
		}
		.robots{
			position: absolute;
			left: 5px;
			top: 5px;
			font-size: 16px;
			/*margin: 5px 5px 0 0;*/
		}
	</style>
</head>
<body>
	<div id="box">
		<ul id="talkBar">
			<li style="text-align: center;margin:0">
				查天气 看笑话 成语接龙 脑筋急转弯 查新闻 查菜谱 查链接
			</li>
			<!-- <li style="text-align: right;">
			<span id="user" style="text-align: right;">你</span id="user">
			<span class="usertalk">你好</span>
			<span class="rightarrow"></span>
			</li>
			<li style="text-align: left;"><p style="text-align: left;">秃秃</p><span class="left"></span><span class="robotstalk">咦，怎么又是这句话呀</span></li> -->
		</ul>
		<div id="inputBar">
			<input type="text">
			<button>发送</button>
		</div>
		<div id="popBox">
			<ul>
			</ul>
			<a href="javascript:void(0)" class="gotop">返回顶部</a>
		</div>
	</div>
	<!-- <button id="btn">test</button> -->
	<script type="text/javascript" src="jquery.min.js"></script>
	<script type="text/javascript">
		$(function(){
			function post(){
				$.ajax({//发送请求
					url:"http://www.tuling123.com/openapi/api",
					type:"POST",
					dataType:"json",
					data:{//要发送过去的参数
						"key":"6c75134ae3574be7ac97267396c0a92b",
						"info":$("#inputBar input").val(),//发过去的信息
						"userid":1234//用户id，机器人上下文聊天的标记
					},
					success:function(data){
						console.log(data)
						// console.log(data.list[0].detailurl)
						var spanright=$("<span />",{class:"usertalk"}).html($("#inputBar input").val())//用于存放用户输入的聊天内容
						var rightarrow=$("<span />",{class:"rightarrow"});//每一句聊天项的那个小箭头
						var user=$("<span />",{class:"user"}).html('你');//用户显示栏
						$("<li />").css({textAlign:"right"}).appendTo($("#talkBar")).append(user).append(spanright).append(rightarrow);//插入聊天内容
						var robots=$("<span />",{class:"robots"}).html('秃秃');//机器人的名字
						var leftarrow=$("<span />",{class:"leftarrow"});//每一句聊天项的那个小箭头
						if(data.code===100000){//文本类数据
							var spanleft=$("<span />",{class:"robotstalk"}).html(data.text)//用于存放机器人返回的信息
							$("<li />").css({textAlign:"left"}).appendTo($("#talkBar")).append(robots).append(leftarrow).append(spanleft);//插入返回信息
						}else if(data.code===200000){//链接类数据
							// console.log(data.url)
							var urldate='<p><a href="'+data.url+'" target="_blank">'+$("#inputBar input").val()+'</a></p>';
							var spanleft=$("<span />",{class:"robotstalk"}).html(urldate);
							$("<li />").css({textAlign:"left"}).appendTo($("#talkBar")).append(robots).append(leftarrow).append(spanleft);
						}else if(data.code==302000){//新闻类数据
							// console.log(data.list.length)
							$("#popBox ul").html("");//清空之前蒙层里的东西
							var newtitle='<a href="javascript:void(0)">'+data.text+'</a>';
							var spanleft=$("<span />",{class:"robotstalk"}).html(newtitle);
							$("<li />").css({textAlign:"left"}).appendTo($("#talkBar")).append(robots).append(leftarrow).append(spanleft).on("click",function(e){
								for(var i=0;i<data.list.length;i++){
									var newdate='<h2>'+data.list[i].article+'</h2>'+
												'<p><a href="'+data.list[i].detailurl+'" target="_blank"><img src="'+data.list[i].icon+'"></a></p>'
									$("<li />").html(newdate).appendTo($("#popBox ul"));
								}
								$("#popBox").fadeIn();//蒙层淡入
								e.stopPropagation();//阻止冒泡
							})
						}else if(data.code==308000){//餐谱类数据
							$("#popBox ul").html("");//清空之前蒙层里的东西
							var foodtitle='<a href="javascript:void(0)">'+$("#inputBar input").val()+'的做法</a>'
							var spanleft=$("<span />",{class:"robotstalk"}).html(foodtitle);
							$("<li />").css({textAlign:"left"}).appendTo($("#talkBar")).append(robots).append(leftarrow).append(spanleft).on("click",function(e){//点击链接弹出蒙层，列出详细的菜单信息
								for(var j=0;j<data.list.length;j++){
									var foodlist='<h2>'+data.list[j].name+'</h2>'+
												'<p><a href="'+data.list[j].detailurl+'" target="_blank">主要材料:'+data.list[j].info+'</a></p>';
									$("<li />").html(foodlist).css({textAlign:"center"}).appendTo("#popBox ul")
								}
								$("#popBox").fadeIn();//蒙层淡入
								e.stopPropagation();//阻止冒泡
							})
						}else {
							$("<li />").html(data.text).appendTo($("#talkBar"));
						}
						var sTop=$("#talkBar").scrollTop();
						if($("#talkBar")[0].scrollHeight>$("#talkBar").outerHeight(true)){//判断最后一条聊天信息是否已超出聊天框的高度
							$("#talkBar").animate({//超出高度滚动调自动向下滚动
								scrollTop:sTop+132
							},100)
						}
						$("#inputBar input").val("");
					}
				})
			}
			$("#inputBar button").on("click",function(){
				if($("#inputBar input").val()==""){
					alert("请输入信息")
				}else{
					post();//点击发送按钮发送请求
				}
					
			});
			$("#inputBar input").on("keypress",function(e){
				
				if(e.keyCode==13){
					if($("#inputBar input").val()==""){
						alert("请输入信息")
					}else{
						post();//输入框输入回车发送请求	
					}
				}
			})
			$("#btn").on("click",function(e){
				$("#popBox").fadeIn();
				e.stopPropagation();
			})
			$("#popBox").on("click","h2",function(e){//取消蒙层里面内容的冒泡，只有在点击空白处时蒙层才消失
				e.stopPropagation();
			})
			$("#popBox").on("click","p",function(e){//取消蒙层里面内容的冒泡，只有在点击空白处时蒙层才消失
				e.stopPropagation();
			})
			$(window).on("click",function(){
				$("#popBox").fadeOut()
			})
			$("#popBox").on("scroll",function(){
				console.log(1);
				if($("#popBox").scrollTop()>100){
					$(".gotop").css({display:"block"});
				}else{
					$(".gotop").css({display:"none"});
				}
			})
			$(".gotop").on("click",function(e){
				$("#popBox").animate({
					scrollTop:0
				})
				e.stopPropagation()
			})
		})
	</script>
</body>
</html>